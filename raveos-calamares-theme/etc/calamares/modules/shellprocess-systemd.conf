script:
  - name: install-cachy-kernel-install-hook
    description: "Install systemd kernel-install hook for RaveOS"
    timeout: 60
    command:
      - sh
      - -c
      - |
          # Target root (always /mnt in Calamares)
          ROOT=/mnt

          # Sanity check
          if [ ! -d "$ROOT/usr" ]; then
              echo "ERROR: Calamares target not mounted at /mnt"
              exit 1
          fi

          # Ensure destination directory exists
          mkdir -p "$ROOT/usr/lib/kernel/install.d"

          # Copy hook into installed system
          cp /usr/share/calamares/kernel-install/95-raveos.install \
             "$ROOT/usr/lib/kernel/install.d/95-raveos.install"

          chmod 0755 "$ROOT/usr/lib/kernel/install.d/95-raveos.install"
